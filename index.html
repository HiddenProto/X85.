<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browser</title>
  <link rel="icon" href="https://discord.com/assets/2c21aea2d0ed.gif">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#23272a;color:#dcddde;font-family:"gg sans",sans-serif;overflow:hidden;display:flex;height:100vh}
    #sidebar{width:240px;background:#2c2f33;padding-top:70px;position:fixed;left:0;top:0;bottom:0;overflow-y:auto}
    .topbar{position:fixed;top:0;left:0;right:0;height:60px;background:#2c2f33;display:flex;align-items:center;padding:0 16px;gap:12px;z-index:1000;box-shadow:0 1px 0 #1e2124}
    .urlbar{flex:1;padding:10px 16px;background:#1e2124;border:none;border-radius:8px;color:white;font-size:15px;outline:none}
    .urlbar:focus{box-shadow:0 0 0 2px #5865f2}
    .go{background:#5865f2;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600}
    iframe{flex:1;height:calc(100vh - 60px);border:none;background:#23272a;margin-left:240px}
    .bookmark{padding:12px 16px;border-bottom:1px solid #1e2124;cursor:pointer;transition:.2s}
    .bookmark:hover{background:#36393f}
    .add-btn{background:#248046;color:white;border:none;padding:12px;border-radius:6px;margin:16px;cursor:pointer;font-weight:600}
  </style>
</head>
<body>

  <div class="topbar">
    <input type="text" class="urlbar" id="url" placeholder="Search or enter URL..." autofocus>
    <button class="go" onclick="go()">Go</button>
  </div>

  <div id="sidebar">
    <button class="add-btn" onclick="addCurrent()">+ Save Current Page</button>
    <div id="bookmarks"></div>
  </div>

  <iframe id="frame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals"></iframe>

  <script src="https://cdn.jsdelivr.net/gh/titaniumnetwork-dev/Ultraviolet@latest/dist/ultraviolet.app.js"></script>
  <script>
    const uv = new Ultraviolet({ prefix:'/~/', bare:'https://uv.tls.b64.captain/' });
    const frame = document.getElementById('frame');
    const input = document.getElementById('url');
    const bookmarksDiv = document.getElementById('bookmarks');

    function go(){
      let url = input.value.trim();
      if(!url) return;
      if(!url.startsWith('http')) url = 'https://google.com/search?q='+encodeURIComponent(url);
      const encoded = __uv$config.prefix + __uv$config.encodeUrl(url);
      frame.src = encoded;
      input.value = url;
    }

    input.addEventListener('keypress', e=>{ if(e.key==='Enter') go(); });

    // Load Discord by default
    window.addEventListener('load', ()=>{
      if(!localStorage.getItem('firstVisitDone')){
        input.value = 'https://discord.com/app';
        go();
        localStorage.setItem('firstVisitDone','true');
      }
      renderBookmarks();
    });

    // Bookmarks system
    function renderBookmarks(){
      const bookmarks = JSON.parse(localStorage.getItem('bookmarks')||'[]');
      bookmarksDiv.innerHTML = '';
      bookmarks.forEach((b,i)=>{
        const div = document.createElement('div');
        div.className = 'bookmark';
        div.textContent = b.title || b.url;
        div.title = b.url;
        div.onclick = ()=>{ input.value = b.url; go(); };
        bookmarksDiv.appendChild(div);
      });
    }

    function addCurrent(){
      const current = input.value || frame.contentWindow.location.href;
      if(!current || current.includes('google.com/search')) return;
      let title = prompt('Name for this bookmark?', new URL(current).hostname);
      const bookmarks = JSON.parse(localStorage.getItem('bookmarks')||'[]');
      bookmarks.push({url:current, title:title||'Untitled'});
      localStorage.setItem('bookmarks',JSON.stringify(bookmarks));
      renderBookmarks();
    }

    // Auto-update URL bar when navigating inside iframe (optional but cool)
    frame.addEventListener('load', ()=>{
      try{
        const realUrl = frame.contentWindow.location.href;
        if(realUrl.includes('discord.com')||realUrl.includes('youtube.com')) input.value = realUrl.split('/~/')[0];
      }catch(e){}
    });
  </script>
</body>
</html>
